var ASS=function(){"use strict";function t(t){const e=t.toLowerCase().trim().split(/\s*;\s*/);return"banner"===e[0]?{name:e[0],delay:1*e[1]||0,leftToRight:1*e[2]||0,fadeAwayWidth:1*e[3]||0}:/^scroll\s/.test(e[0])?{name:e[0],y1:Math.min(1*e[1],1*e[2]),y2:Math.max(1*e[1],1*e[2]),delay:1*e[3]||0,fadeAwayHeight:1*e[4]||0}:""!==t?{name:t}:null}function e(t){return t?t.toLowerCase().replace(/([+-]?(?:\d+(?:\.\d*)?|\.\d+)(?:e[+-]?\d+)?)/g," $1 ").replace(/([mnlbspc])/g," $1 ").trim().replace(/\s+/g," ").split(/\s(?=[mnlbspc])/).map((t=>t.split(" ").filter(((t,e)=>!(e&&Number.isNaN(1*t)))))):[]}const s=["b","i","u","s","fsp","k","K","kf","ko","kt","fe","q","p","pbo","a","an","fscx","fscy","fax","fay","frx","fry","frz","fr","be","blur","bord","xbord","ybord","shad","xshad","yshad"].map((t=>({name:t,regex:new RegExp(`^${t}-?\\d`)})));function a(t){const n={};for(let e=0;e<s.length;e++){const{name:a,regex:r}=s[e];if(r.test(t))return n[a]=1*t.slice(a.length),n}if(/^fn/.test(t))n.fn=t.slice(2);else if(/^r/.test(t))n.r=t.slice(1);else if(/^fs[\d+-]/.test(t))n.fs=t.slice(2);else if(/^\d?c&?H?[0-9a-fA-F]+|^\d?c$/.test(t)){const[,e,s]=t.match(/^(\d?)c&?H?(\w*)/);n[`c${e||1}`]=s&&`000000${s}`.slice(-6)}else if(/^\da&?H?[0-9a-fA-F]+/.test(t)){const[,e,s]=t.match(/^(\d)a&?H?([0-9a-f]+)/i);n[`a${e}`]=`00${s}`.slice(-2)}else if(/^alpha&?H?[0-9a-fA-F]+/.test(t))[,n.alpha]=t.match(/^alpha&?H?([0-9a-f]+)/i),n.alpha=`00${n.alpha}`.slice(-2);else if(/^(?:pos|org|move|fad|fade)\([^)]+/.test(t)){const[,e,s]=t.match(/^(\w+)\((.*?)\)?$/);n[e]=s.trim().split(/\s*,\s*/).map(Number)}else if(/^i?clip\([^)]+/.test(t)){const s=t.match(/^i?clip\((.*?)\)?$/)[1].trim().split(/\s*,\s*/);n.clip={inverse:/iclip/.test(t),scale:1,drawing:null,dots:null},1===s.length&&(n.clip.drawing=e(s[0])),2===s.length&&(n.clip.scale=1*s[0],n.clip.drawing=e(s[1])),4===s.length&&(n.clip.dots=s.map(Number))}else if(/^t\(/.test(t)){const e=t.match(/^t\((.*?)\)?$/)[1].trim().replace(/\\.*/,(t=>t.replace(/,/g,"\n"))).split(/\s*,\s*/);if(!e[0])return n;n.t={t1:0,t2:0,accel:1,tags:e[e.length-1].replace(/\n/g,",").split("\\").slice(1).map(a)},2===e.length&&(n.t.accel=1*e[0]),3===e.length&&(n.t.t1=1*e[0],n.t.t2=1*e[1]),4===e.length&&(n.t.t1=1*e[0],n.t.t2=1*e[1],n.t.accel=1*e[2])}return n}function n(t){const e=[];let s=0,n="";const r=t.split("\\").slice(1).concat("").join("\\");for(let t=0;t<r.length;t++){const a=r[t];"("===a&&s++,")"===a&&s--,s<0&&(s=0),s||"\\"!==a?n+=a:(n&&e.push(n),n="")}return e.map(a)}function r(t){const s=t.split(/{([^{}]*?)}/),a=[];s[0].length&&a.push({tags:[],text:s[0],drawing:[]});for(let t=1;t<s.length;t+=2){const r=n(s[t]),i=r.reduce(((t,e)=>void 0===e.p?t:!!e.p),!1);a.push({tags:r,text:i?"":s[t+1],drawing:i?e(s[t+1]):[]})}return{raw:t,combined:a.map((t=>t.text)).join(""),parsed:a}}function i(t){const e=t.split(":");return 3600*e[0]+60*e[1]+1*e[2]}function o(e,s){let a=e.split(",");if(a.length>s.length){const t=a.slice(s.length-1).join();a=a.slice(0,s.length-1),a.push(t)}const n={};for(let e=0;e<a.length;e++){const o=s[e],l=a[e].trim();switch(o){case"Layer":case"MarginL":case"MarginR":case"MarginV":n[o]=1*l;break;case"Start":case"End":n[o]=i(l);break;case"Effect":n[o]=t(l);break;case"Text":n[o]=r(l);break;default:n[o]=l}}return n}const l=["Name","Fontname","Fontsize","PrimaryColour","SecondaryColour","OutlineColour","BackColour","Bold","Italic","Underline","StrikeOut","ScaleX","ScaleY","Spacing","Angle","BorderStyle","Outline","Shadow","Alignment","MarginL","MarginR","MarginV","Encoding"],c=["Layer","Start","End","Style","Name","MarginL","MarginR","MarginV","Effect","Text"];function d(t){const e=l.concat(c);return t.match(/Format\s*:\s*(.*)/i)[1].split(/\s*,\s*/).map((t=>e.find((e=>e.toLowerCase()===t.toLowerCase()))||t))}function f(t,e){const s=t.match(/Style\s*:\s*(.*)/i)[1].split(/\s*,\s*/);return Object.assign({},...e.map(((t,e)=>({[t]:s[e]}))))}function p(t){const e={type:null,prev:null,next:null,points:[]};/[mnlbs]/.test(t[0])&&(e.type=t[0].toUpperCase().replace("N","L").replace("B","C"));for(let s=t.length-!(1&t.length),a=1;a<s;a+=2)e.points.push({x:1*t[a],y:1*t[a+1]});return e}function h(t){return!(!t.points.length||!t.type)&&!(/C|S/.test(t.type)&&t.points.length<3)}function u(t){return t.map((({type:t,points:e})=>t+e.map((({x:t,y:e})=>`${t},${e}`)).join(","))).join("")}function g(t){const e=[];let s=0;for(;s<t.length;){const a=t[s],n=p(a);if(h(n)){if("S"===n.type){const{x:t,y:a}=(e[s-1]||{points:[{x:0,y:0}]}).points.slice(-1)[0];n.points.unshift({x:t,y:a})}s&&(n.prev=e[s-1].type,e[s-1].next=n.type),e.push(n),s++}else{if(s&&"S"===e[s-1].type){const t={p:n.points,c:e[s-1].points.slice(0,3)};e[s-1].points=e[s-1].points.concat((t[a[0]]||[]).map((({x:t,y:e})=>({x:t,y:e}))))}t.splice(s,1)}}const a=[].concat(...e.map((({type:t,points:e,prev:s,next:a})=>"S"===t?function(t,e,s){const a=[],n=[0,2/3,1/3,0],r=[0,1/3,2/3,0],i=[0,1/6,2/3,1/6],o=(t,e)=>t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3];let l=[t[t.length-1].x,t[0].x,t[1].x,t[2].x],c=[t[t.length-1].y,t[0].y,t[1].y,t[2].y];a.push({type:"M"===e?"M":"L",points:[{x:o(i,l),y:o(i,c)}]});for(let e=3;e<t.length;e++)l=[t[e-3].x,t[e-2].x,t[e-1].x,t[e].x],c=[t[e-3].y,t[e-2].y,t[e-1].y,t[e].y],a.push({type:"C",points:[{x:o(n,l),y:o(n,c)},{x:o(r,l),y:o(r,c)},{x:o(i,l),y:o(i,c)}]});if("L"===s||"C"===s){const e=t[t.length-1];a.push({type:"L",points:[{x:e.x,y:e.y}]})}return a}(e,s,a):{type:t,points:e})));return Object.assign({instructions:a,d:u(a)},function(t){let e=1/0,s=1/0,a=-1/0,n=-1/0;return[].concat(...t.map((({points:t})=>t))).forEach((({x:t,y:r})=>{e=Math.min(e,t),s=Math.min(s,r),a=Math.max(a,t),n=Math.max(n,r)})),{minX:e,minY:s,width:a-e,height:n-s}}(e))}const y=["fs","fsp","clip","c1","c2","c3","c4","a1","a2","a3","a4","alpha","fscx","fscy","fax","fay","frx","fry","frz","fr","be","blur","bord","xbord","ybord","shad","xshad","yshad"];function m(t,e,s={}){let a=t[e];if(void 0===a)return null;if("pos"===e||"org"===e)return 2===a.length?{[e]:{x:a[0],y:a[1]}}:null;if("move"===e){const[t,e,s,n,r=0,i=0]=a;return 4===a.length||6===a.length?{move:{x1:t,y1:e,x2:s,y2:n,t1:r,t2:i}}:null}if("fad"===e||"fade"===e){if(2===a.length){const[t,e]=a;return{fade:{type:"fad",t1:t,t2:e}}}if(7===a.length){const[t,e,s,n,r,i,o]=a;return{fade:{type:"fade",a1:t,a2:e,a3:s,t1:n,t2:r,t3:i,t4:o}}}return null}if("clip"===e){const{inverse:t,scale:e,drawing:s,dots:n}=a;if(s)return{clip:{inverse:t,scale:e,drawing:g(s),dots:n}};if(n){const[a,r,i,o]=n;return{clip:{inverse:t,scale:e,drawing:s,dots:{x1:a,y1:r,x2:i,y2:o}}}}return null}if(/^[xy]?(bord|shad)$/.test(e)&&(a=Math.max(a,0)),"bord"===e)return{xbord:a,ybord:a};if("shad"===e)return{xshad:a,yshad:a};if(/^c\d$/.test(e))return{[e]:a||s[e]};if("alpha"===e)return{a1:a,a2:a,a3:a,a4:a};if("fr"===e)return{frz:a};if("fs"===e)return{fs:/^\+|-/.test(a)?(1*a>-10?1+a/10:1)*s.fs:1*a};if("K"===e)return{kf:a};if("t"===e){const{t1:t,accel:e,tags:n}=a,r=a.t2||1e3*(s.end-s.start),i={};return n.forEach((t=>{const e=Object.keys(t)[0];~y.indexOf(e)&&("clip"!==e||t[e].dots)&&Object.assign(i,m(t,e,s))})),{t:{t1:t,t2:r,accel:e,tag:i}}}return{[e]:a}}const x=[null,1,2,3,null,7,8,9,null,4,5,6],b=["r","a","an","pos","org","move","fade","fad","clip"];function v({styles:t,style:e,parsed:s,start:a,end:n}){let r,i,o,l,c,d;const f=[];let p={style:e,fragments:[]},h={};for(let y=0;y<s.length;y++){const{tags:v,text:w,drawing:S}=s[y];let $;for(let t=0;t<v.length;t++){const e=v[t];$=void 0===e.r?$:e.r}const A={tag:void 0===$?(u=h,JSON.parse(JSON.stringify(Object.assign({},u,{k:void 0,kf:void 0,ko:void 0,kt:void 0})))):{},text:w,drawing:S.length?g(S):null};for(let s=0;s<v.length;s++){const f=v[s];r=r||x[f.a||0]||f.an,i=i||m(f,"pos"),o=o||m(f,"org"),l=l||m(f,"move"),c=c||m(f,"fade")||m(f,"fad"),d=m(f,"clip")||d;const p=Object.keys(f)[0];if(p&&!~b.indexOf(p)){const s=t[e].tag,{c1:r,c2:i,c3:o,c4:l}=s,c=m(f,p,{start:a,end:n,c1:r,c2:i,c3:o,c4:l,fs:h.fs||s.fs});"t"===p?(A.tag.t=A.tag.t||[],A.tag.t.push(c.t)):Object.assign(A.tag,c)}}if(h=A.tag,void 0!==$&&(f.push(p),p={style:t[$]?$:e,fragments:[]}),A.text||A.drawing){const t=p.fragments[p.fragments.length-1]||{};t.text&&A.text&&!Object.keys(A.tag).length?t.text+=A.text:p.fragments.push(A)}}var u;return f.push(p),Object.assign({alignment:r,slices:f},i,o,l,c,d)}function w({styles:t,dialogues:e}){let s=1/0;const a=[];for(let n=0;n<e.length;n++){const r=e[n];if(r.Start>=r.End)continue;t[r.Style]||(r.Style="Default");const i=t[r.Style].style,o=v({styles:t,style:r.Style,parsed:r.Text.parsed,start:r.Start,end:r.End}),l=o.alignment||i.Alignment;s=Math.min(s,r.Layer),a.push(Object.assign({layer:r.Layer,start:r.Start,end:r.End,style:r.Style,name:r.Name,margin:{left:r.MarginL||i.MarginL,right:r.MarginR||i.MarginR,vertical:r.MarginV||i.MarginV},effect:r.Effect},o,{alignment:l}))}for(let t=0;t<a.length;t++)a[t].layer-=s;return a.sort(((t,e)=>t.start-e.start||t.end-e.end))}const S={Name:"Default",Fontname:"Arial",Fontsize:"20",PrimaryColour:"&H00FFFFFF&",SecondaryColour:"&H000000FF&",OutlineColour:"&H00000000&",BackColour:"&H00000000&",Bold:"0",Italic:"0",Underline:"0",StrikeOut:"0",ScaleX:"100",ScaleY:"100",Spacing:"0",Angle:"0",BorderStyle:"1",Outline:"2",Shadow:"2",Alignment:"2",MarginL:"10",MarginR:"10",MarginV:"10",Encoding:"1"};function $(t){if(/^(&|H|&H)[0-9a-f]{6,}/i.test(t)){const[,e,s]=t.match(/&?H?([0-9a-f]{2})?([0-9a-f]{6})/i);return[e||"00",s]}const e=parseInt(t,10);if(!Number.isNaN(e)){const t=-2147483648;if(e<t)return["00","000000"];const s=t<=e&&e<=2147483647?`00000000${(e<0?e+4294967296:e).toString(16)}`.slice(-8):String(e).slice(0,8);return[s.slice(0,2),s.slice(2)]}return["00","000000"]}function A(t,e={}){const s=function(t){const e={info:{},styles:{format:[],style:[]},events:{format:[],comment:[],dialogue:[]}},s=t.split(/\r?\n/);let a=0;for(let t=0;t<s.length;t++){const n=s[t].trim();if(!/^;/.test(n)&&(/^\[Script Info\]/i.test(n)?a=1:/^\[V4\+? Styles\]/i.test(n)?a=2:/^\[Events\]/i.test(n)?a=3:/^\[.*\]/.test(n)&&(a=0),0!==a)){if(1===a&&/:/.test(n)){const[,t,s]=n.match(/(.*?)\s*:\s*(.*)/);e.info[t]=s}if(2===a&&(/^Format\s*:/i.test(n)&&(e.styles.format=d(n)),/^Style\s*:/i.test(n)&&e.styles.style.push(f(n,e.styles.format))),3===a&&(/^Format\s*:/i.test(n)&&(e.events.format=d(n)),/^(?:Comment|Dialogue)\s*:/i.test(n))){const[,t,s]=n.match(/^(\w+?)\s*:\s*(.*)/i);e.events[t.toLowerCase()].push(o(s,e.events.format))}}}return e}(t),a=function({info:t,style:e,defaultStyle:s}){const a={},n=[Object.assign({},s,{Name:"Default"})].concat(e);for(let e=0;e<n.length;e++){const s=Object.assign({},S,n[e]);/^(\*+)Default$/.test(s.Name)&&(s.Name="Default"),Object.keys(s).forEach((t=>{"Name"===t||"Fontname"===t||/Colour/.test(t)||(s[t]*=1)}));const[r,i]=$(s.PrimaryColour),[o,l]=$(s.SecondaryColour),[c,d]=$(s.OutlineColour),[f,p]=$(s.BackColour),h={fn:s.Fontname,fs:s.Fontsize,c1:i,a1:r,c2:l,a2:o,c3:d,a3:c,c4:p,a4:f,b:Math.abs(s.Bold),i:Math.abs(s.Italic),u:Math.abs(s.Underline),s:Math.abs(s.StrikeOut),fscx:s.ScaleX,fscy:s.ScaleY,fsp:s.Spacing,frz:s.Angle,xbord:s.Outline,ybord:s.Outline,xshad:s.Shadow,yshad:s.Shadow,fe:s.Encoding,q:/^[0-3]$/.test(t.WrapStyle)?1*t.WrapStyle:2};a[s.Name]={style:s,tag:h}}return a}({info:s.info,style:s.styles.style,defaultStyle:e.defaultStyle||{}});return{info:s.info,width:1*s.info.PlayResX||null,height:1*s.info.PlayResY||null,collisions:s.info.Collisions||"Normal",styles:a,dialogues:w({styles:a,dialogues:s.events.dialogue})}}function k(t){return 1-`0x${t}`/255}function M(t){const e=t.match(/(\w\w)(\w\w)(\w\w)(\w\w)/),s=k(e[1]),a=+`0x${e[2]}`,n=+`0x${e[3]}`;return`rgba(${+`0x${e[4]}`},${n},${a},${s})`}function E(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(t=>{const e=Math.trunc(16*Math.random());return("x"===t?e:3&e|8).toString(16)}))}function C(t,e=[]){const s=document.createElementNS("http://www.w3.org/2000/svg",t);for(let t=0;t<e.length;t+=1){const a=e[t];s.setAttributeNS("xlink:href"===a[0]?"http://www.w3.org/1999/xlink":null,a[0],a[1])}return s}function O(t,e,s){const a=t.animate(e,s);return a.pause(),a}function j(t,e){(t.animations||[]).forEach((t=>{t[e]()}))}const N=document.createElement("div");N.className="ASS-fix-font-size";const L=document.createElement("span");L.textContent="0",N.append(L);const F=2048,R=Object.create(null);function z([t,e]){return[[0,0],[0,1],[1,0],[1,1]].filter((([s,a])=>(s||t)&&(a||e))).map((([s,a])=>[(s||-1)*t,(a||-1)*e]))}function T(t,e){const s=M(`00${t.c3}`),a=t.xbord*e,n=t.ybord*e,r=M(`00${t.c4}`),i=t.blur||t.be||0,o=function(t,e){if(t===e)return[];const s=Math.min(t,e),a=Math.max(t,e);return Array.from({length:Math.ceil(a)-1},((t,e)=>e+1)).concat(a).map((t=>[(a-t)/a*s,t])).map((([s,a])=>t>e?[a,s]:[s,a])).flatMap(z)}(a,n);return[["border-width",2*Math.min(a,n)+"px"],["border-color",s],["border-opacity",k(t.a3)],["border-delta",o.map((([t,e])=>`${t}px ${e}px ${s}`)).join(",")],["shadow-color",r],["shadow-opacity",k(t.a4)],["shadow-delta",o.map((([t,e])=>`${t}px ${e}px ${r}`)).join(",")],["tag-blur",i],["tag-xbord",t.xbord],["tag-ybord",t.ybord],["tag-xshad",t.xshad],["tag-yshad",t.yshad]].map((([t,e])=>[`--ass-${t}`,e]))}window.CSS.registerProperty&&(window.CSS.registerProperty({name:"--ass-border-width",syntax:"<length>",inherits:!0,initialValue:"0px"}),["border-color","shadow-color"].forEach((t=>{window.CSS.registerProperty({name:`--ass-${t}`,syntax:"<color>",inherits:!0,initialValue:"transparent"})})),["border-opacity","shadow-opacity"].forEach((t=>{window.CSS.registerProperty({name:`--ass-${t}`,syntax:"<number>",inherits:!0,initialValue:"1"})})),["blur","xbord","ybord","xshad","yshad"].forEach((t=>{window.CSS.registerProperty({name:`--ass-tag-${t}`,syntax:"<number>",inherits:!0,initialValue:"0"})})));const B=["frx","fry","frz"],P=["fscx","fscy"],_=["fax","fay"];function H(t){return[...[...B,..._].map((e=>[`--ass-tag-${e}`,`${t[e]||0}`])),...P.map((e=>[`--ass-tag-${e}`,t.p?1:(t[e]||100)/100]))]}function V({effect:t,duration:e}){const{name:s,delay:a,leftToRight:n}=t;if("banner"===s){return[0,`calc(var(--ass-scale) * ${e/(a||1)*(n?1:-1)}px)`].map(((t,e)=>({offset:e,transform:`translateX(${t})`})))}if(s.startsWith("scroll")){return[{offset:0,transform:"translateY(-100%)"},{offset:1,transform:`translateY(calc(var(--ass-scale) * ${e/(a||1)*(/up/.test(s)?-1:1)}px))`}]}return[]}function q({move:t,duration:e,dialogue:s}){const{x1:a,y1:n,x2:r,y2:i,t1:o,t2:l}=t,c=[o,l||e],d=s.pos||{x:0,y:0};return[[a,n],[r,i]].map((([t,e])=>[t-d.x,e-d.y])).map((([t,s],a)=>({offset:Math.min(c[a]/e,1),transform:`translate(calc(var(--ass-scale) * ${t}px), calc(var(--ass-scale) * ${s}px))`})))}function I(t,e){if("fad"===t.type){const{t1:s,t2:a}=t,n=[];return s&&n.push([0,0]),s<e?(a<=e&&n.push([s/e,1]),s+a<e&&n.push([(e-a)/e,1]),a>e?n.push([0,(a-e)/a]):s+a>e&&n.push([(s+.5)/e,1-(s+a-e)/a]),a&&n.push([1,0])):n.push([1,e/s]),n.map((([t,e])=>({offset:t,opacity:e})))}const{a1:s,a2:a,a3:n,t1:r,t2:i,t3:o,t4:l}=t,c=[s,a,n].map((t=>1-t/255));return[0,r,i,o,l,e].map((t=>t/e)).map(((t,e)=>({offset:t,opacity:c[e>>1]}))).filter((({offset:t})=>t<=1))}function U({fromTag:t,tag:e,fragment:s}){const a={...t,...e};return s.drawing&&(Object.assign(a,{p:0,fscx:(e.fscx||t.fscx)/t.fscx*100,fscy:(e.fscy||t.fscy)/t.fscy*100}),Object.assign(t,{fscx:100,fscy:100})),Object.fromEntries(H(a))}function D(t){return[["real-fs",(e=t.fn,s=t.fs,R[e]||(L.style.fontFamily=e,R[e]=L.clientHeight),s*F/R[e])],["tag-fs",t.fs],["tag-fsp",t.fsp],["fill-color",M(t.a1+t.c1)]].filter((([,t])=>t)).map((([t,e])=>[`--ass-${t}`,e]));var e,s}function Y(t,e){const{id:s,clip:a}=t;if(!a)return{};const{width:n,height:r}=e.scriptRes;!function(t,e,s,a,n){if(t.querySelector(`#${s}`))return;let r="";if(null!==e.dots){let{x1:t,y1:s,x2:i,y2:o}=e.dots;t/=a,s/=n,i/=a,o/=n,r=`M${t},${s}L${t},${o},${i},${o},${i},${s}Z`}null!==e.drawing&&(r=e.drawing.instructions.map((({type:t,points:e})=>t+e.map((({x:t,y:e})=>`${t/a},${e/n}`)).join(","))).join(""));const i=1/(1<<e.scale-1);e.inverse&&(r+=`M0,0L0,${i},${i},${i},${i},0,0,0Z`);const o=C("clipPath",[["id",s],["clipPathUnits","objectBoundingBox"]]);o.append(C("path",[["d",r],["transform",`scale(${i})`],["clip-rule","evenodd"]])),t.append(o)}(e.defs,a,s,n,r);const i=document.createElement("div");return e.box.insertBefore(i,t.$div),i.append(t.$div),i.className="ASS-clip-area",i.style.clipPath=`url(#${s})`,{$div:i}}function W(t,e,s){if(!t.drawing.d)return null;const a={...e,...t.tag},{minX:n,minY:r,width:i,height:o}=t.drawing,l=s.scale/(1<<a.p-1),c=(a.fscx?a.fscx/100:1)*l,d=(a.fscy?a.fscy/100:1)*l,f=a.blur||a.be||0,p=a.xbord+(a.xshad<0?-a.xshad:0)+f,h=a.ybord+(a.yshad<0?-a.yshad:0)+f,u=i*c+2*a.xbord+Math.abs(a.xshad)+2*f,g=o*d+2*a.ybord+Math.abs(a.yshad)+2*f,y=C("svg",[["width",u],["height",g],["viewBox",`${-p} ${-h} ${u} ${g}`]]),m=s.sbas?s.scale:1,x=`ASS-${E()}`,b=C("defs");b.append(function(t,e,s){const a=t.xbord||t.ybord,n=t.xshad||t.yshad,r="FF"!==t.a1,i=t.blur||t.be||0,o=C("filter",[["id",e]]);o.append(C("feGaussianBlur",[["stdDeviation",a?0:i],["in","SourceGraphic"],["result","sg_b"]])),o.append(C("feFlood",[["flood-color",M(t.a1+t.c1)],["result","c1"]])),o.append(C("feComposite",[["operator","in"],["in","c1"],["in2","sg_b"],["result","main"]])),a&&(o.append(C("feMorphology",[["radius",`${t.xbord*s} ${t.ybord*s}`],["operator","dilate"],["in","SourceGraphic"],["result","dil"]])),o.append(C("feGaussianBlur",[["stdDeviation",i],["in","dil"],["result","dil_b"]])),o.append(C("feComposite",[["operator","out"],["in","dil_b"],["in2","SourceGraphic"],["result","dil_b_o"]])),o.append(C("feFlood",[["flood-color",M(t.a3+t.c3)],["result","c3"]])),o.append(C("feComposite",[["operator","in"],["in","c3"],["in2","dil_b_o"],["result","border"]]))),n&&(a||r)&&(o.append(C("feOffset",[["dx",t.xshad*s],["dy",t.yshad*s],["in",a?"dil":"SourceGraphic"],["result","off"]])),o.append(C("feGaussianBlur",[["stdDeviation",i],["in","off"],["result","off_b"]])),r||(o.append(C("feOffset",[["dx",t.xshad*s],["dy",t.yshad*s],["in","SourceGraphic"],["result","sg_off"]])),o.append(C("feComposite",[["operator","out"],["in","off_b"],["in2","sg_off"],["result","off_b_o"]]))),o.append(C("feFlood",[["flood-color",M(t.a4+t.c4)],["result","c4"]])),o.append(C("feComposite",[["operator","in"],["in","c4"],["in2",r?"off_b":"off_b_o"],["result","shadow"]])));const l=C("feMerge",[]);return n&&(a||r)&&l.append(C("feMergeNode",[["in","shadow"]])),a&&l.append(C("feMergeNode",[["in","border"]])),l.append(C("feMergeNode",[["in","main"]])),o.append(l),o}(a,x,m)),y.append(b);const v=`ASS-${E()}`,w=C("symbol",[["id",v],["viewBox",`${n} ${r} ${i} ${o}`]]);return w.append(C("path",[["d",t.drawing.d]])),y.append(w),y.append(C("use",[["width",i*c],["height",o*d],["xlink:href",`#${v}`],["filter",`url(#${x})`]])),y.style.cssText=`position:absolute;left:${n*c-p}px;top:${r*d-h}px;`,{$svg:y,cssText:`position:relative;width:${i*c}px;height:${o*d}px;`}}function X(t,e){const{video:s,space:a,scale:n}=e,{layer:r,margin:i,width:o,height:l,alignment:c,end:d}=t,f=e.width-Math.trunc(n*(i.left+i.right)),p=e.height,h=Math.trunc(n*i.vertical),u=100*s.currentTime;a[r]=a[r]||{left:{width:new Uint16Array(p+1),end:new Uint32Array(p+1)},center:{width:new Uint16Array(p+1),end:new Uint32Array(p+1)},right:{width:new Uint16Array(p+1),end:new Uint32Array(p+1)}};const g=a[r],y=["right","left","center"][c%3];let m=0,x=0;const b=t=>(m=(t=>{const e=g.left.width[t],s=g.center.width[t],a=g.right.width[t],n=g.left.end[t],r=g.center.end[t],i=g.right.end[t];return"left"===y&&(n>u&&e||r>u&&s&&2*o+s>f||i>u&&a&&o+a>f)||"center"===y&&(n>u&&e&&2*e+o>f||r>u&&s||i>u&&a&&2*a+o>f)||"right"===y&&(n>u&&e&&e+o>f||r>u&&s&&2*o+s>f||i>u&&a)})(t)?0:m+1,m>=l&&(x=t,!0));if(c<=3){x=p-h-1;for(let t=x;t>h&&!b(t);t-=1);}else if(c>=7){x=h+1;for(let t=x;t<p-h&&!b(t);t+=1);}else{x=p-l>>1;for(let t=x;t<p-h&&!b(t);t+=1);}c>3&&(x-=l-1);for(let t=x;t<x+l;t+=1)g[y].width[t]=o,g[y].end[t]=100*d;return x}function G(t,e){const{$div:s,animations:a}=function(t,e){const{video:s,styles:a}=e,n=document.createElement("div");n.className="ASS-dialogue";const r=document.createDocumentFragment(),{align:i,slices:o,start:l,end:c}=t;[["--ass-align-h",["left","center","right"][i.h]],["--ass-align-v",["bottom","center","top"][i.v]]].forEach((([t,e])=>{n.style.setProperty(t,e)}));const d={duration:1e3*(c-l),delay:1e3*Math.min(0,l-(s.currentTime-e.delay)),fill:"forwards"},f=[];return o.forEach((t=>{const s=a[t.style].tag,n=a[t.style].style.BorderStyle;t.fragments.forEach((t=>{const{text:a,drawing:i}=t,o={...s,...t.tag};let l="";const c=[];if(!i){c.push(...D(o));const t=e.sbas?e.scale:1;c.push(...T(o,t)),l+=`font-family:"${o.fn}";`,l+=o.b?`font-weight:${1===o.b?"bold":o.b};`:"",l+=o.i?"font-style:italic;":"",l+=o.u||o.s?`text-decoration:${o.u?"underline":""} ${o.s?"line-through":""};`:""}if(i&&o.pbo){const t=-o.pbo*(o.fscy||100)/100;l+=`vertical-align:calc(var(--ass-scale) * ${t}px);`}c.push(...H(o));const p=[o,...(o.t||[]).map((t=>t.tag))],h=B.some((t=>p.some((e=>e[t])))),u=P.some((t=>p.some((e=>void 0!==e[t]&&100!==e[t])))),g=_.some((t=>p.some((e=>e[t]))));(function(t,e){return t.replace(/\\h/g," ").replace(/\\N/g,"\n").replace(/\\n/g,2===e?"\n":" ")})(a,o.q).split("\n").forEach(((a,p)=>{const y=document.createElement("span"),m=document.createElement("span");if(y.dataset.wrapStyle=o.q,y.dataset.borderStyle=n,(u||g)&&(u&&(m.dataset.scale=""),g&&(m.dataset.skew=""),m.textContent=a),h&&(y.dataset.rotate=""),i){y.dataset.drawing="";const a=W(t,s,e);if(!a)return;y.style.cssText=a.cssText,y.append(a.$svg)}else{if(y.dataset.text="",p&&r.append(document.createElement("br")),!a)return;u||g?y.append(m):y.textContent=a;const t=u||g?m:y;(o.xbord||o.ybord||o.xshad||o.yshad)&&(t.dataset.text=a)}if(y.style.cssText+=l,c.forEach((([t,e])=>{y.style.setProperty(t,e)})),t.keyframes){const e=O(y,t.keyframes,{...d,duration:t.duration});f.push(e)}r.append(y)}))}))})),t.keyframes&&f.push(O(n,t.keyframes,d)),n.append(r),{$div:n,animations:f}}(t,e);Object.assign(t,{$div:s,animations:a}),e.box.append(s);const{width:n}=s.getBoundingClientRect();Object.assign(t,{width:n}),s.style.cssText+=function(t){const{layer:e,align:s,effect:a,pos:n,margin:r}=t;let i="";return e&&(i+=`z-index:${e};`),i+=`text-align:${["left","center","right"][s.h]};`,a||(i+=`max-width:calc(100% - var(--ass-scale) * ${r.left+r.right}px);`,n||(0!==s.h&&(i+=`margin-right:calc(var(--ass-scale) * ${r.right}px);`),2!==s.h&&(i+=`margin-left:calc(var(--ass-scale) * ${r.left}px);`))),i}(t);const{height:r}=s.getBoundingClientRect();Object.assign(t,{height:r});const{x:i,y:o}=function(t,e){const{scale:s}=e,{effect:a,move:n,align:r,width:i,height:o,margin:l,slices:c}=t;let d=0,f=0;if(a&&"banner"===a.name)d=a.lefttoright?-i:e.width,f=[e.height-o-l.vertical,(e.height-o)/2,l.vertical][r.v];else if(t.pos||n){const e=t.pos||{x:0,y:0},a=s*e.x,n=s*e.y;d=[a,a-i/2,a-i][r.h],f=[n-o,n-o/2,n][r.v]}else d=[0,(e.width-i)/2,e.width-i-s*l.right][r.h],f=c.some((t=>t.fragments.some((({keyframes:t})=>t?.length))))?[e.height-o-l.vertical,(e.height-o)/2,l.vertical][r.v]:X(t,e);return{x:d,y:f}}(t,e);return Object.assign(t,{x:i,y:o}),s.style.cssText+=`width:${n}px;height:${r}px;left:${i}px;top:${o}px;`,function(t,e){const{align:s,width:a,height:n,x:r,y:i,$div:o}=t,l={};t.org?(l.x=t.org.x*e,l.y=t.org.y*e):(l.x=[r,r+a/2,r+a][s.h],l.y=[i+n,i+n/2,i][s.v]);for(let t=o.childNodes.length-1;t>=0;t-=1){const e=o.childNodes[t];if(""===e.dataset.rotate){const t=l.x-r-e.offsetLeft,s=l.y-i-e.offsetTop;e.style.cssText+=`transform-origin:${t}px ${s}px;`}}}(t,e.scale),Object.assign(t,Y(t,e)),t.effect?.name?.startsWith("scroll")&&Object.assign(t,function(t,e){const s=document.createElement("div");s.className="ASS-scroll-area",e.box.insertBefore(s,t.$div),s.append(t.$div);const{height:a}=e.scriptRes,{name:n,y1:r,y2:i}=t.effect,o=Math.min(r,i)/a*100,l=(a-Math.max(r,i))/a*100;s.style.cssText+=`top:${o}%;bottom:${l}%;`;const c=/up/.test(n);return t.$div.style.cssText+=c?"top:100%;":"top:0%;",{$div:s}}(t,e)),t}function Z(t){const{box:e}=t;for(;e.lastChild;)e.lastChild.remove();t.actives=[],t.space=[]}function J(t){const{video:e,dialogues:s,actives:a}=t,n=e.currentTime-t.delay;for(let t=a.length-1;t>=0;t-=1){const e=a[t],{end:s}=e;s<n&&(e.$div.remove(),a.splice(t,1))}for(;t.index<s.length&&n>=s[t.index].start;){if(n<s[t.index].end){const n=G(s[t.index],t);e.paused||j(n,"play"),a.push(n)}t.index+=1}}function K(t){return function(){Z(t);const{video:e,dialogues:s}=t,a=e.currentTime-t.delay;t.index=(()=>{for(let t=0;t<s.length;t+=1)if(a<s[t].end)return t;return(s.length||1)-1})(),J(t)}}window.CSS.registerProperty&&([...B,..._].forEach((t=>{window.CSS.registerProperty({name:`--ass-tag-${t}`,syntax:"<number>",inherits:!0,initialValue:0})})),P.forEach((t=>{window.CSS.registerProperty({name:`--ass-tag-${t}`,syntax:"<number>",inherits:!0,initialValue:1})}))),window.CSS.registerProperty&&(["real-fs","tag-fs","tag-fsp"].forEach((t=>{window.CSS.registerProperty({name:`--ass-${t}`,syntax:"<number>",inherits:!0,initialValue:"0"})})),window.CSS.registerProperty({name:"--ass-fill-color",syntax:"<color>",inherits:!0,initialValue:"transparent"}));return class{#t={video:null,box:document.createElement("div"),svg:C("svg"),defs:C("defs"),observer:null,scale:1,width:0,height:0,scriptRes:{},layoutRes:{},resampledRes:{},index:0,sbas:!0,styles:{},dialogues:[],actives:[],space:[],requestId:0,delay:0};#e;#s;#a;#n;constructor(t,e,{container:s=e.parentNode,resampling:a}={}){if(this.#t.video=e,!s)throw new Error("Missing container.");const{info:n,width:r,height:i,styles:o,dialogues:l}=A(t);this.#t.sbas=/yes/i.test(n.ScaledBorderAndShadow),this.#t.layoutRes={width:1*n.LayoutResX||e.videoWidth||e.clientWidth,height:1*n.LayoutResY||e.videoHeight||e.clientHeight},this.#t.scriptRes={width:r||this.#t.layoutRes.width,height:i||this.#t.layoutRes.height},this.#t.styles=o,this.#t.dialogues=l.map((t=>Object.assign(t,{id:`ASS-${E()}`,align:{h:(t.alignment+2)%3,v:Math.trunc((t.alignment-1)/3)}}))),s.append(N);const{svg:c,defs:d,scriptRes:f,box:p}=this.#t;var h;c.setAttributeNS(null,"viewBox",`0 0 ${f.width} ${f.height}`),c.append(d),s.append(c),p.className="ASS-box",s.append(p),function(t){const e=t.getRootNode()||document,s=e===document?document.head:e;let a=s.querySelector("#ASS-global-style");a||(a=document.createElement("style"),a.type="text/css",a.id="ASS-global-style",a.append(document.createTextNode('.ASS-box{font-family:Arial;overflow:hidden;pointer-events:none;position:absolute}.ASS-dialogue{font-size:0;position:absolute;z-index:0}.ASS-dialogue span{display:inline-block}.ASS-dialogue [data-text]{display:inline-block;color:var(--ass-fill-color);font-size:calc(var(--ass-scale)*var(--ass-real-fs)*1px);line-height:calc(var(--ass-scale)*var(--ass-tag-fs)*1px);letter-spacing:calc(var(--ass-scale)*var(--ass-tag-fsp)*1px)}.ASS-dialogue [data-wrap-style="0"],.ASS-dialogue [data-wrap-style="3"]{text-wrap:balance}.ASS-dialogue [data-wrap-style="1"]{word-break:break-word;white-space:normal}.ASS-dialogue [data-wrap-style="2"]{word-break:normal;white-space:nowrap}.ASS-dialogue [data-border-style="1"]{position:relative}.ASS-dialogue [data-border-style="1"]::after,.ASS-dialogue [data-border-style="1"]::before{content:attr(data-text);position:absolute;top:0;left:0;z-index:-1;filter:blur(calc(var(--ass-tag-blur)*1px))}.ASS-dialogue [data-border-style="1"]::before{color:var(--ass-shadow-color);transform:translate(calc(var(--ass-scale-stroke)*var(--ass-tag-xshad)*1px),calc(var(--ass-scale-stroke)*var(--ass-tag-yshad)*1px));-webkit-text-stroke:var(--ass-border-width) var(--ass-shadow-color);text-shadow:var(--ass-shadow-delta);opacity:var(--ass-shadow-opacity)}.ASS-dialogue [data-border-style="1"]::after{color:transparent;-webkit-text-stroke:var(--ass-border-width) var(--ass-border-color);text-shadow:var(--ass-border-delta);opacity:var(--ass-border-opacity)}.ASS-dialogue [data-border-style="3"]{padding:calc(var(--ass-scale-stroke)*var(--ass-tag-xbord)*1px) calc(var(--ass-scale-stroke)*var(--ass-tag-ybord)*1px);position:relative;filter:blur(calc(var(--ass-tag-blur)*1px))}.ASS-dialogue [data-border-style="3"]::after,.ASS-dialogue [data-border-style="3"]::before{content:"";width:100%;height:100%;position:absolute;z-index:-1}.ASS-dialogue [data-border-style="3"]::before{background-color:var(--ass-shadow-color);left:calc(var(--ass-scale-stroke)*var(--ass-tag-xshad)*1px);top:calc(var(--ass-scale-stroke)*var(--ass-tag-yshad)*1px)}.ASS-dialogue [data-border-style="3"]::after{background-color:var(--ass-border-color);left:0;top:0}@container style(--ass-tag-xbord: 0) and style(--ass-tag-ybord: 0){.ASS-dialogue [data-border-style="3"]::after{background-color:transparent}}@container style(--ass-tag-xshad: 0) and style(--ass-tag-yshad: 0){.ASS-dialogue [data-border-style="3"]::before{background-color:transparent}}.ASS-dialogue [data-rotate]{transform:perspective(312.5px) rotateY(calc(var(--ass-tag-fry)*1deg)) rotateX(calc(var(--ass-tag-frx)*1deg)) rotateZ(calc(var(--ass-tag-frz)*-1deg))}.ASS-dialogue [data-text][data-rotate]{transform-style:preserve-3d;word-break:normal;white-space:nowrap}.ASS-dialogue [data-scale],.ASS-dialogue [data-skew]{display:inline-block;transform:scale(var(--ass-tag-fscx),var(--ass-tag-fscy)) skew(calc(var(--ass-tag-fax)*1rad),calc(var(--ass-tag-fay)*1rad));transform-origin:var(--ass-align-h) var(--ass-align-v)}.ASS-fix-font-size{font-size:2048px;font-family:Arial;line-height:normal;width:0;height:0;position:absolute;visibility:hidden;overflow:hidden}.ASS-clip-area,.ASS-fix-font-size span{position:absolute}.ASS-clip-area{width:100%;height:100%;top:0;left:0}.ASS-scroll-area{position:absolute;width:100%;overflow:hidden}')),s.append(a))}(s),this.#e=(h=this.#t,function(){const t=()=>{J(h),h.requestId=requestAnimationFrame(t)};cancelAnimationFrame(h.requestId),h.requestId=requestAnimationFrame(t),h.actives.forEach((t=>{j(t,"play")}))}),this.#s=function(t){return function(){cancelAnimationFrame(t.requestId),t.requestId=0,t.actives.forEach((t=>{j(t,"pause")}))}}(this.#t),this.#a=K(this.#t),e.addEventListener("play",this.#e),e.addEventListener("pause",this.#s),e.addEventListener("playing",this.#e),e.addEventListener("waiting",this.#s),e.addEventListener("seeking",this.#a),this.#n=function(t,e){const{video:s,box:a,svg:n,layoutRes:r}=e;return function(){const i=s.clientWidth,o=s.clientHeight,l=r.width||s.videoWidth||i,c=r.height||s.videoHeight||o,d=e.scriptRes.width,f=e.scriptRes.height;let p=d,h=f;const u=Math.min(i/l,o/c);"video_width"===t.resampling&&(h=d/l*c),"video_height"===t.resampling&&(p=f/c*l),e.scale=Math.min(i/p,o/h),"script_width"===t.resampling&&(e.scale=u*(l/p)),"script_height"===t.resampling&&(e.scale=u*(c/h));const g=e.scale*p,y=e.scale*h;e.width=g,e.height=y,e.resampledRes={width:p,height:h};const m=`width:${g}px;height:${y}px;top:${(o-y)/2}px;left:${(i-g)/2}px;`;a.style.cssText=m,a.style.setProperty("--ass-scale",e.scale),a.style.setProperty("--ass-scale-stroke",e.sbas?e.scale:1),n.style.cssText=m,K(e)()}}(this,this.#t),this.#n(),this.resampling=a,l.forEach((t=>{!function(t,e){const{start:s,end:a,effect:n,move:r,fade:i,slices:o}=t,l=1e3*(a-s),c=[...n&&!r?V({effect:n,duration:l}):[],...r?q({move:r,duration:l,dialogue:t}):[],...i?I(i,l):[]].sort(((t,e)=>t.offset-e.offset));c.length>0&&Object.assign(t,{keyframes:c}),o.forEach((t=>{const s=e.styles[t.style].tag;t.fragments.forEach((t=>{if(!t.tag.t||0===t.tag.t.length)return;const a={...s,...t.tag},n=(r=t.tag.t,r.reduceRight(((t,e)=>{let s=!1;return t.map((t=>(s=e.t1===t.t1&&e.t2===t.t2&&e.accel===t.accel,{...t,...s?{tag:{...t.tag,...e.tag}}:{}}))).concat(s?[]:e)}),[])).sort(((t,e)=>t.t2-e.t2||t.t1-e.t1));var r;n[0].t1>0&&n.unshift({t1:0,t2:n[0].t1,tag:a}),n.reduce(((t,e)=>{const s={...t,...e.tag};return s.t=null,Object.assign(e.tag,s),s}),{});const i=Math.max(l,...n.map((({t2:t})=>t))),o=n.map((({t2:s,tag:n})=>({offset:s/i,...Object.fromEntries(D({...n,a1:n.a1||a.a1,c1:n.c1||a.c1})),...Object.fromEntries(T({...a,...n},e.sbas?e.scale:1)),...U({fromTag:a,tag:n,fragment:t})}))).sort(((t,e)=>t.offset-e.offset));o.length>0&&Object.assign(t,{keyframes:o,duration:i})}))}))}(t,this.#t)}));const u=new ResizeObserver(this.#n);return u.observe(e),this.#t.observer=u,this}destroy(){const{video:t,box:e,svg:s,observer:a}=this.#t;return this.#s(),Z(this.#t),t.removeEventListener("play",this.#e),t.removeEventListener("pause",this.#s),t.removeEventListener("playing",this.#e),t.removeEventListener("waiting",this.#s),t.removeEventListener("seeking",this.#a),N.remove(),s.remove(),e.remove(),a.unobserve(this.#t.video),this.#t.styles={},this.#t.dialogues=[],this}show(){return this.#t.box.style.visibility="visible",this}hide(){return this.#t.box.style.visibility="hidden",this}#r="video_height";get resampling(){return this.#r}set resampling(t){t!==this.#r&&/^(video|script)_(width|height)$/.test(t)&&(this.#r=t,this.#n())}get delay(){return this.#t.delay}set delay(t){"number"==typeof t&&(this.#t.delay=t,this.#a())}}}();
